#!/bin/bash

# SES - Scribble Execution Service
# Main CLI for Scribble project management

set -e

PROJECT_ROOT="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
SCRIPTS_DIR="$PROJECT_ROOT/scripts"

# Colors
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
BLUE='\033[0;34m'
NC='\033[0m'

# Print usage
show_usage() {
    cat << EOF
${BLUE}╔════════════════════════════════════════╗${NC}
${BLUE}║  SES - Scribble Execution Service     ║${NC}
${BLUE}║  Polyglot Compiler Toolkit           ║${NC}
${BLUE}╚════════════════════════════════════════╝${NC}

${BLUE}Usage:${NC} ses <command> [options]

${BLUE}Commands:${NC}
  ${GREEN}build${NC}      Build compiler and runtime
  ${GREEN}check${NC}      Comprehensive code checker with error report
  ${GREEN}test${NC}       Run test suite (5 tests)
  ${GREEN}lint${NC}       Check code style and issues
  ${GREEN}compile${NC}    Compile .scrib files
  ${GREEN}tree${NC}       Display project structure and stats
  ${GREEN}clean${NC}      Remove build artifacts
  ${GREEN}help${NC}       Show this help message
  ${GREEN}version${NC}    Show version

${BLUE}Examples:${NC}
  ses build
  ses check
  ses test
  ses compile examples/hello.scrib --lang cpp
  ses tree

${BLUE}Full documentation:${NC} See COMMANDS.md

EOF
}

show_version() {
    cat << EOF
${GREEN}SES${NC} v0.1.0
Scribble Execution Service
Polyglot Language Compiler

For more info: https://github.com/Seigh-sword/scribble
EOF
}

# Main command handler
case "${1:-help}" in
    build)
        bash "$SCRIPTS_DIR/build.sh"
        ;;
    check)
        bash "$SCRIPTS_DIR/check.sh"
        ;;
    test)
        bash "$SCRIPTS_DIR/test.sh"
        ;;
    lint)
        bash "$SCRIPTS_DIR/lint.sh"
        ;;
    compile)
        shift
        bash "$SCRIPTS_DIR/compile.sh" "$@"
        ;;
    tree)
        bash "$SCRIPTS_DIR/tree.sh"
        ;;
    clean)
        echo -e "${YELLOW}Cleaning build artifacts...${NC}"
        rm -rf build/
        echo -e "${GREEN}✓ Clean complete${NC}"
        ;;
    version|-v|--version)
        show_version
        ;;
    help|-h|--help)
        show_usage
        ;;
    *)
        echo -e "${RED}✗ Unknown command: ${1}${NC}"
        echo ""
        show_usage
        exit 1
        ;;
esac
